#! /bin/bash
### This file converts bam file to tag align file
### Input: dedup.bam

module load python/3.6.1-2-anaconda
module load samtools/1.4.1
module load bedtools/2.26.0

### Idea behind script from:
#python3 /project/BICF/BICF_Core/shared/Projects/Dorso/Epigenetics/chipseq_analysis/workflow/scripts/convert_reads.py -b /project/BICF/BICF_Core/shared/Projects/Dorso/Epigenetics/chipseq_analysis/work/c0/c46208c6356facd56dcae1ed28b337/SRR2043614.filt.nodup.bam

bam_files=`ls /project/BICF/BICF_Core/shared/Projects/Dorso/Expression/rnaseq/workflow/output_TT/*.dedup.bam`

### Use bedtools to convert to tagAlign
for bam in ${bam_files}; do
  #echo ${bam}
  #prefix=$(basename ${bam} .dedup.bam)
  #echo ${prefix}
  #bamToBed -i $bam | awk 'BEGIN{OFS="\t"}{$4="N";$5="1000";print $0}'| gzip >/project/BICF/BICF_Core/shared/Projects/Dorso/Expression/rnaseq/workflow/output_TT/convert_reads/${prefix}.tagAlign.gz
  python3 /project/BICF/BICF_Core/shared/Projects/Dorso/Epigenetics/chipseq_analysis/workflow/scripts/convert_reads.py -b ${bam} -p
done
